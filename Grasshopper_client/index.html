<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>

		<!--标准mui.css-->
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/feedback-page.css" />
		<link rel="stylesheet" href="css/style.css" />
		<!--App自定义的css-->
		<style type="text/css">
			.mui-slider {
				height: 150px;
			}
			.search {
				
				padding: 0;
				margin: 0;
				text-align: center;
				padding-top: 20px;
			}
			
			.search>ul {
				list-style: none;
				padding-top: 20px;
				width: 30%;
				margin: 0 50% 0 35%;
			}
			
			.search>ul>li {
				z-index: 99;
				padding: 3px;
				border: 1px solid silver;
				box-shadow: 1px 1px;
			}
		</style>
	</head>

	<body>

		<!-- 主界面不动、菜单移动 -->
		<!-- 侧滑导航根容器 -->
		<div class="mui-off-canvas-wrap mui-draggable mui-slide-in">
			<!-- 菜单容器 -->
			<aside class="mui-off-canvas-left" id="offCanvasSide">
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<!-- 菜单具体展示内容 -->

						<ul class="mui-table-view mui-grid-view mui-grid-9">
							<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
								<a id="data">
									<span class="mui-icon mui-icon-person"></span>
									<div class="mui-media-body">资料</div>
								</a>
							</li>
							<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
								<a id="j_examine">
									<span class="mui-icon mui-icon-paperplane"></span>
									<div class="mui-media-body">待审</div>
								</a>
							</li>
							<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
								<a href="#">
									<span class="mui-icon mui-icon-contact"></span>
									<div class="mui-media-body">会员</div>
								</a>
							</li>
							<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
								<a href="#">
									<span class="mui-icon mui-icon-plus"></span>
									<div class="mui-media-body">关注</div>
								</a>
							</li>
							<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
								<a id="j_fans">
									<span class="mui-icon mui-icon-personadd"></span>
									<div class="mui-media-body">粉丝</div>
								</a>
							</li>
							<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3">
								<a id="j_pass">
									<span class="mui-icon mui-icon-paperplane"></span>
									<div class="mui-media-body">审核</div>
								</a>
							</li>
						</ul>

						<ul class="mui-table-view" >
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right" id="j_index">
									<span class="mui-icon mui-icon-home"></span> 首页
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right">
									<span class="mui-icon mui-icon-list"></span> 历史记录
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right">
									<span class="mui-icon mui-icon-star"></span> 我的收藏
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right" id="j_myFocus">
									<span class="mui-icon mui-icon-plus"></span> 我的关注
								</a>
							</li>
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right">
									<span class="mui-icon mui-icon-email"></span> 联系平台
								</a>
							</li>

							<!--
                            	这个设置只起布局作用，无需操作
                            -->
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right">
									<span class="mui-icon mui-icon-gear"></span> 设置
								</a>
							</li>

						</ul>

						<nav class="mui-bar mui-bar-tab">
							<a class="mui-tab-item mui-active">
								<span class="mui-icon mui-icon-videocam"></span>
								<span class="mui-tab-label">夜间</span>
							</a>
							<a class="mui-tab-item">
								<span class="mui-icon mui-icon-flag"></span>
								<span class="mui-tab-label">主题</span>
							</a>
							<a class="mui-tab-item">
								<span class="mui-icon mui-icon-gear"></span>
								<span class="mui-tab-label">设置</span>
							</a>
						</nav>
					</div>
				</div>
			</aside>
			<!-- 主页面容器 -->
			<div class="mui-inner-wrap">
				<!-- 主页面标题 -->
				<header class="mui-bar mui-bar-nav">
					<a class="mui-icon mui-action-menu mui-icon-bars mui-pull-left" href="#offCanvasSide"></a>

					<h1 class="mui-title">蝈蝈社区</h1>
				</header>

				<nav class="mui-bar mui-bar-tab">
					<a class="mui-tab-item mui-active" id="j_index">
						<span class="mui-icon mui-icon-home"></span>
						<span class="mui-tab-label">首页</span>
					</a>
					<a class="mui-tab-item" id="j_editor">
						<span class="mui-icon mui-icon-compose"></span>
						<span class="mui-tab-label">编辑</span>
					</a>
					<a class="mui-tab-item" id="j_condition">
						<span class="mui-icon mui-icon-pengyouquan"></span>
						<span class="mui-tab-label">动态</span>
					</a>
					<a class="mui-tab-item">
						<span class="mui-icon mui-icon-chat"></span>
						<span class="mui-tab-label">私信</span>
					</a>
				</nav>

				<!--下拉刷新容器-->
				<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
					<div class="mui-scroll">
						<!-- 主界面具体展示内容 -->
						<div id="slider" class="mui-slider">
							<div class="mui-slider-group mui-slider-loop">
								<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
								<div class="mui-slider-item mui-slider-item-duplicate">
									<a href="#">
										<img src="http://placehold.it/400x300">
									</a>
								</div>
								<!-- 第一张 -->
								<div class="mui-slider-item">
									<a href="#">
										<img src="http://192.168.0.106:8080/Grasshopper_server/images/1.jpg" style="width: 100%;height: 100%;">
									</a>
								</div>
								<!-- 第二张 -->
								<div class="mui-slider-item">
									<a href="#">
										<img src="http://192.168.0.106:8080/Grasshopper_server/images/2.jpg" style="width: 100%;height: 100%;">
									</a>
								</div>
								<!-- 第三张 -->
								<div class="mui-slider-item">
									<a href="#">
										<img src="http://192.168.0.106:8080/Grasshopper_server/images/3.jpg" style="width: 100%;height: 100%;">
									</a>
								</div>
								<!-- 第四张 -->
								<div class="mui-slider-item">
									<a href="#">
										<img src="http://192.168.0.106:8080/Grasshopper_server/images/4.jpg" style="width: 100%;height: 100%;">
									</a>
								</div>
								<!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
								<div class="mui-slider-item mui-slider-item-duplicate">
									<a href="#">
										<img src="http://placehold.it/400x300">
									</a>
								</div>
							</div>
							
							<div class="mui-slider-indicator">
								<div class="mui-indicator mui-active"></div>
								<div class="mui-indicator"></div>
								<div class="mui-indicator"></div>
								<div class="mui-indicator"></div>
							</div>
						</div>
							<div class="search"> <input type="text" id="txt" onchange="ch()"> <button type="button" id="btn">search</button>
			              <ul id="list"> </ul>
		              </div>
						<!--数据列表-->
						<ul class="mui-table-view mui-table-view-chevron" id="listView">
							<input type="hidden" id="user_name" value="">
							<input type="hidden" id="user_id" value="">
						</ul>  
					</div>
				</div>

				<div class="mui-off-canvas-backdrop"></div>
			</div>
		</div>
		<script type="text/javascript" src="js/mui.min.js"></script>
		<script type="text/javascript" src="js/mui.view.js"></script>
		<script type="text/javascript" src="js/app.js"></script>

		<script>
			mui.init({
				pullRefresh: {
					container: '#pullrefresh',
					down: {
						callback: pursfoudom
					},
					up: {
						contentrefresh: '正在加载...',
						/*callback: pullupRefresh*/
						callback: axs
					}
				}
			});

			//页面请求全局路径
			window.path = "http://192.168.0.106:8080/Grasshopper_server/";
			/**
			 * 下拉刷新具体业务实现
			 */
			function pulldownRefresh() {
				setTimeout(function() {
					var ul = document.getElementById("ul");
					while(ul.hasChildNodes()) {
						ul.removeChild(ul.firstChild);
					}
					var table = document.body.querySelector('.mui-table-view-chevron');
					var cells = document.body.querySelectorAll('#mui-table-view-cell');
					for(var i = cells.length, len = i + 5; i < len; i++) {
						var li = document.createElement('li');
						li.className = 'mui-table-view-cell';
						li.id = 'mui-table-view-cell';
						li.innerHTML = '<a class="mui-navigate-right">测试 ' + (i + 1) + '</a>';
						//下拉刷新，新纪录插到最前面；
						table.insertBefore(li, table.firstChild);
					}
					mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
				}, 1500);
			}

			var count = 0;

			function axs() {
				var s;
				var method;
				console.log(count);
				method = "up";
				if(count <= 0) {
					s = 0
				} else {
					var cells = document.body.querySelectorAll('#mui-table-view-cell');
					s = document.getElementsByName("id")[cells.length - 1].value;
				};
				mui.get(window.path + 'TestfServlet?method=' + method, {
					s: s,
				}, function(data) {
					setTimeout(function() {
						console.log(data);
						var table = document.body.querySelector('.mui-table-view-chevron');
						var cells = document.body.querySelectorAll('#mui-table-view-cell');
						mui('#pullrefresh').pullRefresh().endPullupToRefresh((++count > data.count)); //参数为true代表没有更多数据了。
						console.log(data.count);
						for(var i = 0, len = data.resultN.length; i < len; i++) {
							var li = document.createElement('li');
							li.className = 'mui-table-view-cell';
							li.id = 'mui-table-view-cell';
							li.innerHTML = '<a class="mui-navigate-right">测试 id是<input type="hidden" name="id" value=' + data.resultN[i].id + '>' + data.resultN[i].id + "标题是" + data.resultN[i].title + "分类是" + data.resultN[i].type + '</a>';
							table.appendChild(li);
						}
					}, 1500);
				}, 'json');
			}

			function pursfoudom() {
				var s = document.getElementsByName("id")[0];
				console.log(s.value);
				var h = s.value;
				mui.get(window.path + 'TestfServlet?method=down', {
					h: h
				}, function(data) {
					setTimeout(function() {
						var table = document.body.querySelector('.mui-table-view-chevron');
						var cells = document.body.querySelectorAll('#mui-table-view-cell');
						for(var i = 0, len = data.resultH.length; i < len; i++) {
							var li = document.createElement('li');
							li.className = 'mui-table-view-cell';
							li.id = 'mui-table-view-cell';
							li.innerHTML = '<a class="mui-navigate-right">测试 id是<input type="hidden" name="id" value=' + data.resultH[i].id + '>' + data.resultH[i].id + "标题是" + data.resultH[i].title + "分类是" + data.resultH[i].type + '</a>';
							//下拉刷新，新纪录插到最前面；
							table.insertBefore(li, table.firstChild);
						}
						mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed								
					}, 1500);
				}, 'json');
			}

			/**
			 * 上拉加载具体业务实现
			 */
			function pullupRefresh() {
				setTimeout(function() {

					mui('#pullrefresh').pullRefresh().endPullupToRefresh((++count > 2)); //参数为true代表没有更多数据了。
					var table = document.body.querySelector('.mui-table-view-chevron');
					var cells = document.body.querySelectorAll('#mui-table-view-cell');
					for(var i = cells.length, len = i + 5; i < len; i++) {
						var li = document.createElement('li');
						li.className = 'mui-table-view-cell';
						li.id = 'mui-table-view-cell';
						li.innerHTML = '<a class="mui-navigate-right">测试 一开始上' + (i + 1) + '</a>';
						table.appendChild(li);
					}
				}, 1500);
			}

			if(mui.os.plus) {
				mui.plusReady(function() {
					setTimeout(function() {
						mui('#pullrefresh').pullRefresh().pullupLoading();
					}, 1000);

				});
			} else {
				mui.ready(function() {
					mui('#pullrefresh').pullRefresh().pullupLoading();
				});
			}
		</script>

		<!--查看用户个人信息的js-->
		<script>
			mui.init({
				statusBarBackground: '#f7f7f7'
			});
            document.getElementById("user_name").value = localStorage.getItem("user_name");
			document.getElementById("user_id").value = localStorage.getItem("user_id");
			var user_name = document.getElementById("user_name").value;
			var user_id = document.getElementById("user_id").value;
			//页面请求全局路径
			window.path = "http://192.168.0.106:8080/Grasshopper_server/";
            var fan = document.getElementById("fans");
			var dat = document.getElementById("data");
			mui.trigger(fan, 'tap');
			mui.trigger(dat, 'tap');

			dat.addEventListener("tap", function() {
				var user = "小明";
				//服务器中接口的地址			
				/*mui.ajax('http://localhost/api/MyServlet',{
					//向服务器发送数据
					
					dataType:'json',//服务器返回json格式数据
					type:'get',//HTTP请求类型
					success:function(data){
						//获得服务器响应，获取服务响应的数据
						console.log(data);
					}
				});*/
				mui.post(window.path + 'QueryUserServlet', {
					method: "StatusCode",
					user: user
				}, function(data) {
					console.log(data);
					if(data.resultCode == "200") {
						//原生的js跳转页面
						//window.location.href="xxx.html";

						//mui框架的跳转
						mui.openWindow({
							url: 'queryuser.html',
							show: {
								autoShow: true
							}
						});

					} else {
						alert("查看失败!");
					}
				}, 'json');
			});
			//监听点击事件
			fan.addEventListener("tap", function() {
				var id = user_id;
				//服务器中接口的地址			
				/*mui.ajax('http://localhost/api/MyServlet',{
					//向服务器发送数据
					
					dataType:'json',//服务器返回json格式数据
					type:'get',//HTTP请求类型
					success:function(data){
						//获得服务器响应，获取服务响应的数据
						console.log(data);
					}
				});*/
				mui.post(window.path + 'FansServlet', {
					method: "StatusCode",
					id: id
				}, function(data) {
					console.log(data);
					if(data.resultCode == "200") {
						//原生的js跳转页面
						//window.location.href="xxx.html";

						//mui框架的跳转
						mui.openWindow({
							url: 'Fans.html',
						});
					} else {
						alert("查看失败!");
					}
				}, 'json');
			});	
			
			
			mui("#listView").on('tap','.mui-navigate-right',function(){
				var id = this.getAttribute("release_id");
				var user_id = user_id;
				mui.post(window.path + 'CommenterServlet', {
					method: "StatusCode",
					id: id,
					user_id: user_id
				}, function(data) {
					console.log(data);
					if(data.resultCode == "200") {
						//原生的js跳转页面
						//window.location.href="xxx.html";

						//mui框架的跳转
						mui.openWindow({
							url: 'commenter.html',							
						});
					localStorage.setItem("release_id",id);
					} else {
						alert("查看失败!");
					}
				}, 'json');
			})
		</script>
		<script>
			var myf = document.getElementById("j_myFocus");
			mui.trigger(myf, 'tap');
			//监听点击事件
			myf.addEventListener("tap", function() {
				mui.openWindow({
					url: 'myFocus.html',
					show: {
						autoShow: true
					}
				});
			});
			var con = document.getElementById("j_condition");
			mui.trigger(con, 'tap');
			//监听点击事件
			con.addEventListener("tap", function() {
				mui.openWindow({
					url: 'condition.html',
					show: {
						autoShow: true
					}
				});
			});
			var edi = document.getElementById("j_editor");
			mui.trigger(edi, 'tap');
			//监听点击事件
			edi.addEventListener("tap", function() {
				mui.openWindow({
					url: 'editor.html',
					show: {
						autoShow: true
					}
				});
			});
			var ind = document.getElementById("j_index");
			mui.trigger(ind, 'tap');
			//监听点击事件
			ind.addEventListener("tap", function() {
				mui.openWindow({
					url: 'index.html',
					show: {
						autoShow: true
					}
				});
			});
			var exa = document.getElementById("j_examine");
			mui.trigger(exa, 'tap');
			//监听点击事件
			exa.addEventListener("tap", function() {
				mui.openWindow({
					url: 'examine.html',
					show: {
						autoShow: true
					}
				});
			});
			
			var fan = document.getElementById("j_fans");
			mui.trigger(fan, 'tap');
			//监听点击事件
			fan.addEventListener("tap", function() {
				mui.openWindow({
					url: 'fans.html',
					show: {
						autoShow: true
					}
				});
			});

			var pas = document.getElementById("j_pass");
			mui.trigger(pas, 'tap');
			//监听点击事件

			pas.addEventListener("tap", function() {
				mui.openWindow({
					url: 'pass.html',
					show: {
						autoShow: true
					}
				});
			});
		
		</script>
		<script>
			/**     * Created by Steven on 2016-10-25.     */
			
			var oTxt = document.getElementById('txt');
			var oBtn = document.getElementById('btn');
			var oList = document.getElementById('list');
			var fruits = ["桃子", "苹果", "梨子", "香蕉", "香瓜", "葡萄", "柠檬", "橘子", "草莓", "草莓子", "草拟吗", "s", "ssr"];
			//点击事件
			oBtn.addEventListener('click', function() {
				var keyWord = oTxt.value; // var fruitList = searchByIndexOf(keyWord,fruits);   
				console.log(fruitList);
				var fruitList = searchByRegExp(keyWord, fruits);
				renderFruits(fruitList);
			}, false);
			function ch(){
				//回车查询   
			
					var keyWord = oTxt.value;
					// var fruitList = searchByIndexOf(keyWord,fruits); 
					var fruitList = searchByRegExp(keyWord, fruits);
					renderFruits(fruitList);
		
			}
			//回车查询   
			oTxt.addEventListener('keydown', function(e) {
				if(e.keyCode == 13) {
					var keyWord = oTxt.value;
					// var fruitList = searchByIndexOf(keyWord,fruits); 
					var fruitList = searchByRegExp(keyWord, fruits);
					renderFruits(fruitList);
				}
			}, false);
			var cpLock = false;
			
			$('#txt').on('compositionstart', function() {
				cpLock = true;
				console.log("不搜索")
			});
			$('#txt').on('compositionend', function() {
				cpLock = false;
				console.log("汉字搜索");
				var keyWord = oTxt.value;
				// var fruitList = searchByIndexOf(keyWord,fruits);  
				var fruitList = searchByRegExp(keyWord, fruits);
				renderFruits(fruitList);
			});
			$('#txt').on('input', function() {
				if(!cpLock) {
					console.log("字母搜索")
					var keyWord = oTxt.value;
					// var fruitList = searchByIndexOf(keyWord,fruits);
					var fruitList = searchByRegExp(keyWord, fruits);
					renderFruits(fruitList);
				}
			});

			function renderFruits(list) {
				if(!(list instanceof Array)) {
					return;
				}
				oList.innerHTML = '';
				var len = list.length;
				var item = null;
				for(var i = 0; i < len; i++) {
					item = document.createElement('li');
					item.innerHTML = list[i];
					oList.appendChild(item);
				}
			}
			//模糊匹配的时候如果不区分大小写，可以使用toLowerCase()或者toUpperCase()转换之后去匹配。  
			//模糊查询1:利用字符串的indexOf方法    
			function searchByIndexOf(keyWord, list) {
				if(!(list instanceof Array)) {
					return;
				}
				var len = list.length;
				var arr = [];
				for(var i = 0; i < len; i++) {
					//如果字符串中不包含目标字符会返回-1   
					if(list[i].indexOf(keyWord) >= 0) {
						arr.push(list[i]);
					}
				}
				return arr;
			}
			//正则匹配    
			function searchByRegExp(keyWord, list) {
				if(!(list instanceof Array)) {
					return;
				}
				var len = list.length;
				var arr = [];
				var reg = new RegExp(keyWord);
				for(var i = 0; i < len; i++) {
					//如果字符串中不包含目标字符会返回-1    
					if(list[i].match(reg)) {
						arr.push(list[i]);
					}
				}
				return arr;
			}
			renderFruits(fruits);
			
		</script>
	</body>

</html>