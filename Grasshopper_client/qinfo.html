<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<!--标准mui.css-->
		<link rel="stylesheet" href="css/mui.min.css">
		<!--App自定义的css-->
		
		<style>
			.title {
				margin: 20px 15px 10px;
				color: #6d6d72;
				font-size: 15px;
			}
			.user{
				display: block;
				width: 50px;	
				cursor: pointer;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">media list（图文列表测试）</h1>
		</header>
		<div class="mui-content">
			用户名:<a class="user" id="user_name"></a>
			<ul class="mui-table-view" id="content">
			<script id="test" type="text/html">	
				{{each resultData}} <!-- resultData和服务端返回的名字必须一致-->
				<li class="mui-table-view-cell mui-media">
					<a href="javascript:;">
						<img class="mui-media-object mui-pull-left" src={{$value.imgurl}}>
						<div class="mui-media-body">
							{{$value.title}}
							<p class='mui-ellipsis'>{{$value.content}}</p>
						</div>
					</a>
				</li>
				{{/each}}
			</script>
			</ul>
			
		</div>

	</body>
	<script src="js/mui.min.js"></script>
	<!--导入模板引擎的js 
		
		使用mui框架的ajax从服务器端请求获取到数据之后通过js的模板引擎将数据渲染到html中
		
	-->
	<script src="js/template-web.js"></script>
	<script>
		//页面请求全局路径
		window.path="http://localhost:8080/Grasshopper_server/";
		mui.init({
			swipeBack:true //启用右滑关闭功能
		});
		
		mui.get(window.path+'TestServlet?method=GetData',function(data){
			console.log(data);
		//获得服务器响应
		var html = template("test",data);
		//从Servlet返回的响应中获取存入的用户名并且赋值到id命名的a标签中
		document.getElementById('user_name').innerText = data.name;
		document.getElementById('content').innerHTML = html;
		
	},'json'
	
	); 
	
	//给a标签按钮绑定点击事件
	var a = document.getElementById("user_name");
	//触发a标签的点击事件
	mui.trigger(a,'tap');
	//监听点击事件
	a.addEventListener("tap",function () {
					//获取用户名
				var user_name=document.getElementById("user_name").text;
	
						
								
					//服务器中接口的地址			
					/*mui.ajax('http://localhost/api/MyServlet',{
						//向服务器发送数据
					
						dataType:'json',//服务器返回json格式数据
						type:'get',//HTTP请求类型
						success:function(data){
							//获得服务器响应，获取服务响应的数据
							console.log(data);
						}
					});*/
						mui.post(window.path+'QueryUserServlet',{
							method:"quer",
							//把用户名作为条件,并中请求Servlet时获取作为查询条件
							user_name:user_name,
						},function(data){
							console.log(data);
							if(data.resultCode=="200")
							{
								alert("查看成功！");
								
								//原生的js跳转页面
								//window.location.href="xxx.html";
								
								
								//mui框架的跳转
								mui.openWindow({
									    url: 'queryuser.html', 
									    show:{
									      autoShow:false
									    }
  								});
								
							}else{
								alert("查看失败!");
							}
						},'json'
					);
				
				});
					
	</script>
</html>